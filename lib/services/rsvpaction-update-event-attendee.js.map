{"version":3,"sources":["../../src/server/services/rsvpaction-update-event-attendee.js"],"names":["updateAttendeeOnRsvpAction","request","response","input","_type","eventId","event","user","gateway","call","_id","rsvpResponse","$addToSet","attenddee","$pull","register"],"mappings":";;AAAA;;;;;;AAMA,SAASA,0BAAT,CAAoCC,OAApC,EAA6CC,QAA7C,EAAuD;AACrD,MAAI,CAACD,QAAQE,KAAR,CAAcC,KAAf,KAAyB,YAA7B,EAA2C;AAAE;AAAS;;AAEtD,MAAMC,UAAUJ,QAAQE,KAAR,CAAcG,KAA9B;AACA,MAAMC,OAAON,QAAQE,KAAR,CAAcI,IAA3B;;AAEA;AACA,MAAMD,QAAQE,QAAQC,IAAR,CAAa,eAAb,EAA8B,EAACC,KAAKL,OAAN,EAA9B,CAAd;;AAEA;AACA,MAAIJ,QAAQE,KAAR,CAAcQ,YAAd,KAA+B,KAAnC,EAA0C;AACxC;AACAH,YAAQC,IAAR,CAAa,iBAAb,EAAgC,EAAEC,KAAKJ,KAAP,EAAcM,WAAW,EAAEC,WAAWN,IAAb,EAAzB,EAAhC;AACD,GAHD,MAGO;AACL;AACAC,YAAQC,IAAR,CAAa,iBAAb,EAAgC,EAAEC,KAAKJ,KAAP,EAAcQ,OAAO,EAAED,WAAWN,IAAb,EAArB,EAAhC;AACD;AACF;;AAEDC,QAAQO,QAAR,CAAiB,gCAAjB,EAAmDf,0BAAnD","file":"rsvpaction-update-event-attendee.js","sourcesContent":["/**\n * update the Event Attendees when a RsvpAction is received\n * @param {HttpClientRequest} request the http request object\n * @param {*} response the response object\n * @returns {void}\n */\nfunction updateAttendeeOnRsvpAction(request, response) {\n  if (!request.input._type === 'RsvpAction') { return; }\n\n  const eventId = request.input.event;\n  const user = request.input.user;\n\n  // TODO check if this user has RsvpAction access\n  const event = gateway.call('document:read', {_id: eventId});\n\n  // we only add the attendees to the Event\n  if (request.input.rsvpResponse === 'Yes') {\n    // if no there add it\n    gateway.call('document:update', { _id: event, $addToSet: { attenddee: user }});\n  } else {\n    // if there remove it\n    gateway.call('document:update', { _id: event, $pull: { attenddee: user }});\n  }\n}\n\ngateway.register('update-attendee-on-rsvp-action', updateAttendeeOnRsvpAction);"]}